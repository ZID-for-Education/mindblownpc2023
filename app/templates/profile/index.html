{% extends "base.html" %}

{% block title %}Profile{% endblock %}
{% block content %}
    <h1>Profile</h1>
    <div id="container"></div>
    <script src="https://cdn.jsdelivr.net/npm/d3@7"></script>
    <script type="module">
        const data = {{ dailyData|safe }};

        const width = 640;
        const height = 400;
        const marginTop = 20;
        const marginRight = 20;
        const marginBottom = 30;
        const marginLeft = 40;

        // Declare the x (horizontal position) scale.
        const x = d3.scaleBand()
            .domain(data.map(row => row["set"]))
            .range([marginLeft, width - marginRight])

        // Declare the y (vertical position) scale.
        const y = d3.scaleLinear()
            .domain([0, d3.max(data, row => row["score"])]).nice()
            .range([height - marginBottom, marginTop]);

        // Create the SVG container.
        const svg = d3.create("svg")
        .attr("viewBox", [0, 0, width, height])
        .attr("style", `max-width: ${width}px; height: auto; font: 10px sans-serif; overflow: visible;`);

        // Add the bars.
        const bar = svg.append("g")
            .attr("fill", "steelblue")
            .selectAll("rect")
            .data(data)
            .join("rect")
            .attr("x", row => x(row["set"]))
            .attr("y", row => y(row["score"]))
            .attr("height", row => y(0) - y(row["score"]))
            .attr("width", x.bandwidth());

        const gx = svg.append("g")
            .attr("transform", `translate(0,${height - marginBottom})`)
            .call(d3.axisBottom(x).tickSizeOuter(0));

        const gy = svg.append("g")
            .attr("transform", `translate(${marginLeft},0)`)
            .call(d3.axisLeft(y).tickFormat((y) => (y * 100).toFixed()))

        // Append the SVG element.
        container.append(svg.node());

    </script>
{% endblock %}